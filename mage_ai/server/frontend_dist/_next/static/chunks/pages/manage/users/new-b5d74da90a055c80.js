(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3277],{94629:function(e,r,n){"use strict";n.d(r,{Z:function(){return S}});var t=n(82394),o=n(21831),i=n(82684),u=n(50724),s=n(1402),a=n(97618),l=n(70613),d=n(31557),c=n(68899),f=n(28598);function p(e,r){var n=e.children,t=e.noPadding;return(0,f.jsx)(c.HS,{noPadding:t,ref:r,children:n})}var v=i.forwardRef(p),h=n(62547),m=n(82571),b=n(98464),w=n(77417),O=n(46684),j=n(70515),g=n(53808),y=n(19183);function Z(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function _(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?Z(Object(n),!0).forEach((function(r){(0,t.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function P(e,r){e.addProjectBreadcrumbToCustomBreadcrumbs;var n=e.after,t=e.afterHeader,p=e.afterHidden,Z=e.afterWidth,P=e.afterWidthOverride,S=e.appendBreadcrumbs,x=e.before,C=e.beforeHeader,E=e.beforeWidth,I=e.breadcrumbs,k=e.children,M=e.contained,R=e.errors,T=e.headerMenuItems,W=e.headerOffset,A=e.hideAfterCompletely,H=e.mainContainerHeader,D=e.navigationItems,N=e.setAfterHidden,U=e.setAfterWidth,B=e.setBeforeWidth,F=e.setErrors,q=e.subheaderChildren,L=e.subheaderNoPadding,G=e.title,K=e.uuid,z=(0,y.i)().width,X="dashboard_after_width_".concat(K),Q="dashboard_before_width_".concat(K),J=Math.max((0,g.U2)(X,30*j.iI),30*j.iI)||30*j.iI,V=Math.max((0,g.U2)(Q,30*j.iI),30*j.iI)||30*j.iI,Y=(0,i.useRef)(null),$=(0,i.useState)(!1),ee=$[0],re=$[1],ne=(0,i.useState)(null),te=ne[0],oe=ne[1],ie=(0,i.useMemo)((function(){return"undefined"!==typeof U||P?Z:te}),[Z,te,P,U]),ue=(0,i.useCallback)((function(e){var r=e;return U?U(e):oe(e),(0,g.t8)(X,Math.max(r,20*j.iI)),r}),[X,U,oe]);(0,i.useEffect)((function(){n&&!ie&&ue(J?Math.max(J,20*j.iI):Z)}),[]);var se=(0,i.useState)(null),ae=se[0],le=se[1],de=(0,i.useMemo)((function(){return"undefined"!==typeof B?E:ae}),[E,ae,B]),ce=(0,i.useCallback)((function(e){var r=e;return B?B(e):le(e),(0,g.t8)(Q,Math.max(r,20*j.iI)),r}),[Q,B,le]);(0,i.useEffect)((function(){x&&!de&&ce(V?Math.max(V,20*j.iI):E)}),[]);var fe=(0,i.useState)(!1),pe=fe[0],ve=fe[1],he=(0,i.useState)(null)[1],me=(0,w.Z)().project,be=[];I&&be.push.apply(be,(0,o.Z)(I)),null!==I&&void 0!==I&&I.length&&!S||!me||null!==I&&void 0!==I&&I.length||be.unshift({bold:!S,label:function(){return G}}),(0,i.useEffect)((function(){null===Y||void 0===Y||!Y.current||ee||pe||null===he||void 0===he||he(Y.current.getBoundingClientRect().width)}),[ee,ie,pe,de,Y,he,z]),(0,i.useEffect)((function(){ee||(0,g.t8)(X,ie)}),[p,ee,ie,X]),(0,i.useEffect)((function(){pe||(0,g.t8)(Q,de)}),[pe,de,Q]);var we=(0,b.Z)(Z);return(0,i.useEffect)((function(){P&&we!==Z&&ue(Z)}),[P,Z,we]),(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(l.Z,{title:G}),(0,f.jsx)(d.Z,{breadcrumbs:be,menuItems:T}),(0,f.jsxs)(c.Nk,{ref:r,children:[0!==(null===D||void 0===D?void 0:D.length)&&(0,f.jsx)(c.lm,{showMore:!0,children:(0,f.jsx)(m.Z,{navigationItems:D,showMore:!0})}),(0,f.jsx)(a.Z,{flex:1,flexDirection:"column",children:(0,f.jsxs)(h.Z,{after:n,afterHeader:t,afterHeightOffset:O.Mz,afterHidden:p,afterMousedownActive:ee,afterWidth:ie,before:x,beforeHeader:C,beforeHeightOffset:O.Mz,beforeMousedownActive:pe,beforeWidth:x?de:c.k1,contained:M,headerOffset:W,hideAfterCompletely:!n||!N||A,leftOffset:x?c.k1:null,mainContainerHeader:H,mainContainerRef:Y,setAfterHidden:N,setAfterMousedownActive:re,setAfterWidth:ue,setBeforeMousedownActive:ve,setBeforeWidth:ce,children:[q&&(0,f.jsx)(v,{noPadding:L,children:q}),k]})})]}),R&&(0,f.jsx)(u.Z,{disableClickOutside:!0,isOpen:!0,onClickOutside:function(){return null===F||void 0===F?void 0:F(null)},children:(0,f.jsx)(s.Z,_(_({},R),{},{onClose:function(){return null===F||void 0===F?void 0:F(null)}}))})]})}var S=i.forwardRef(P)},14875:function(e,r,n){"use strict";n.d(r,{Z3:function(){return t},ms:function(){return i},s7:function(){return o}});var t=[{autoComplete:"username",label:"Username",required:!0,uuid:"username"},{autoComplete:"email",disabled:!1,label:"Email",required:!0,type:"email",uuid:"email"}],o="password_current",i=[{autoComplete:"current-password",label:"Current password",type:"password",uuid:o},{autoComplete:"new-password",label:"New password",type:"password",uuid:"password"},{autoComplete:"new-password",label:"Confirm new password",type:"password",uuid:"password_confirmation"}]},36043:function(e,r,n){"use strict";var t=n(82394),o=n(21831),i=n(75582),u=n(21764),s=n(82684),a=n(69864),l=n(71180),d=n(31882),c=n(55485),f=n(85854),p=n(44085),v=n(38276),h=n(30160),m=n(17488),b=n(35686),w=n(98464),O=n(82359),j=n(14875),g=n(86735),y=n(50178),Z=n(42122),_=n(72619),P=n(28598);function S(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function x(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?S(Object(n),!0).forEach((function(r){(0,t.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}r.Z=function(e){var r=e.disabledFields,n=e.hideFields,S=e.newUser,C=e.onDeleteSuccess,E=e.onSaveSuccess,I=e.showDelete,k=e.title,M=e.user,R=(0,s.useState)(!0),T=R[0],W=R[1],A=(0,s.useState)({}),H=A[0],D=A[1],N=(0,s.useState)(null),U=N[0],B=N[1],F=((0,y.PR)()||{}).owner,q=b.ZP.statuses.list().data,L=(0,s.useMemo)((function(){var e;return(null===q||void 0===q||null===(e=q.statuses)||void 0===e?void 0:e[0])||{}}),[q]),G=L.project_type,K=L.project_uuid,z="global",X=null,Q=null;G===O.k.SUB?(z="project",X=K):G===O.k.MAIN&&(Q="The roles selected here will apply to this user globally.\n                If a user has both a global role and a workspace role,\n                then the role with higher access will take precedence.");var J=b.ZP.roles.list({entity:z,entity_ids:X?[X]:[],limit_roles:!!S},{revalidateOnFocus:!1}),V=J.data,Y=(J.mutate,(0,s.useMemo)((function(){return(null===V||void 0===V?void 0:V.roles)||[]}),[null===V||void 0===V?void 0:V.roles])),$=(0,a.Db)(S?b.ZP.users.useCreate():b.ZP.users.useUpdate(null===M||void 0===M?void 0:M.id),{onSuccess:function(e){return(0,_.wD)(e,{callback:function(e){var r=e.user,n=j.Z3.concat(j.ms).map((function(e){return e.uuid}));n.push("id");var t=(0,Z.GL)(r,n);B(t),u.Am.success(S?"New user created successfully.":"User profile successfully updated.",{position:u.Am.POSITION.BOTTOM_RIGHT,toastId:"user-update-success-".concat(r.id)}),null===E||void 0===E||E(t)},onErrorCallback:function(e){var r=e.error,n=r.errors,t=r.exception,o=r.message,i=r.type;u.Am.error((null===n||void 0===n?void 0:n.error)||t||o,{position:u.Am.POSITION.BOTTOM_RIGHT,toastId:i})}})}}),ee=(0,i.Z)($,2),re=ee[0],ne=ee[1].isLoading,te=(0,a.Db)(b.ZP.users.useDelete(null===M||void 0===M?void 0:M.id),{onSuccess:function(e){return(0,_.wD)(e,{callback:function(){null===C||void 0===C||C()},onErrorCallback:function(e){var r=e.error,n=r.errors,t=r.message;alert(t),console.log(n)}})}}),oe=(0,i.Z)(te,2),ie=oe[0],ue=oe[1].isLoading,se=n?(0,o.Z)(n):[];S&&se.push(j.s7);var ae=!se||!se.includes(j.s7),le=(0,w.Z)(M);(0,s.useEffect)((function(){if(M&&(!U||(null===le||void 0===le?void 0:le.id)!==(null===M||void 0===M?void 0:M.id))){var e=j.Z3.concat(j.ms).map((function(e){return e.uuid}));B((0,Z.GL)(M,e))}null!==U&&void 0!==U&&U.password||null!==U&&void 0!==U&&U.password_confirmation?(null===U||void 0===U?void 0:U.password)!==(null===U||void 0===U?void 0:U.password_confirmation)?D({password_confirmation:"Password confirmation does not match."}):!ae||null!==U&&void 0!==U&&U.password_current?D(null):D({password_current:"This field is required."}):null!==U&&void 0!==U&&U.password_current&&ae?null!==U&&void 0!==U&&U.password&&null!==U&&void 0!==U&&U.password_confirmation?D(null):D({password:"This field is required.",password_confirmation:"This field is required."}):null!==U&&void 0!==U&&U.password_current||null!==U&&void 0!==U&&U.password||null!==U&&void 0!==U&&U.password_confirmation||D(null)}),[U,ae,M,le]);var de=(0,s.useState)(!1),ce=de[0],fe=de[1],pe=(0,s.useMemo)((function(){return(ce?null===U||void 0===U?void 0:U.roles_new:null===M||void 0===M?void 0:M.roles_new)||[]}),[U,ce,M]),ve=(0,s.useMemo)((function(){var e=(null===Y||void 0===Y?void 0:Y.map((function(e){return e.id})))||[];return null===pe||void 0===pe?void 0:pe.filter((function(r){var n=r.id;return e.includes(n)}))}),[pe,Y]);return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(f.Z,{children:k||"Edit profile"}),(0,P.jsxs)("form",{children:[j.Z3.filter((function(e){var r=e.uuid;return!se||!se.includes(r)})).map((function(e){var r=e.autoComplete,n=e.disabled,o=e.label,i=e.required,u=e.type,s=e.uuid;return(0,P.jsx)(v.Z,{mt:2,children:(0,P.jsx)(m.Z,{autoComplete:r,disabled:n&&!S,label:o,onChange:function(e){W(!1),B((function(r){return x(x({},r),{},(0,t.Z)({},s,e.target.value))}))},primary:!0,required:i,setContentOnMount:!0,type:u,value:(null===U||void 0===U?void 0:U[s])||""})},s)})),!(null!==M&&void 0!==M&&M.owner)&&!(null!==se&&void 0!==se&&se.includes("roles"))&&(0,P.jsxs)(v.Z,{mt:2,children:[Q&&(0,P.jsx)(v.Z,{mb:1,children:(0,P.jsx)(h.ZP,{children:Q})}),(0,P.jsx)(p.Z,{disabled:null===r||void 0===r?void 0:r.includes("roles"),label:"Roles",onChange:function(e){var r=(0,g.sE)(Y,(function(r){return r.id==e.target.value}));r&&(W(!1),fe(!0),B((function(e){var n={};return(0,g.sE)(pe,(function(e){return e.id==(null===r||void 0===r?void 0:r.id)}))||(n={roles_new:[].concat((0,o.Z)(pe),[r])}),x(x({},e),n)})))},primary:!0,setContentOnMount:!0,children:Y.map((function(e){var r=e.id,n=e.name;return(0,P.jsx)("option",{value:r,children:n},n)}))}),(0,P.jsx)(v.Z,{mb:1}),(0,P.jsx)(c.ZP,{alignItems:"center",flexWrap:"wrap",children:null===ve||void 0===ve?void 0:ve.map((function(e){var n=e.id,t=e.name;return(0,P.jsx)(v.Z,{mb:1,mr:1,children:(0,P.jsx)(d.Z,{disabled:null===r||void 0===r?void 0:r.includes("roles"),label:t,onClick:function(){W(!1),fe(!0),B((function(e){return x(x({},e),{},{roles_new:(0,g.Od)(pe,(function(e){return e.id===n}))})}))},primary:!0})},"user_roles/".concat(t))}))})]}),(0,P.jsxs)(v.Z,{mt:5,children:[(0,P.jsx)(f.Z,{children:S?"Password":"Change password"}),j.ms.filter((function(e){var r=e.uuid;return!se||!se.includes(r)})).map((function(e){var r=e.autoComplete,n=e.disabled,o=e.label,i=e.required,u=e.type,s=e.uuid;return(0,P.jsx)(v.Z,{mt:2,children:(0,P.jsx)(m.Z,{autoComplete:r,disabled:n,label:o,meta:{error:null===H||void 0===H?void 0:H[s],touched:!(null===H||void 0===H||!H[s])},onChange:function(e){W(!1),B((function(r){return x(x({},r),{},(0,t.Z)({},s,e.target.value))}))},primary:!0,required:i,setContentOnMount:!0,type:u,value:(null===U||void 0===U?void 0:U[s])||""})},s)}))]}),(0,P.jsx)(v.Z,{mt:5,children:(0,P.jsxs)(c.ZP,{children:[(0,P.jsx)(l.ZP,{disabled:T||H&&!(0,Z.Qr)(H),loading:ne,onClick:function(){var e,r=x({},U);"roles_new"in r&&(r.roles_new=null===(e=U.roles_new)||void 0===e?void 0:e.map((function(e){return e.id})));re({user:r})},primary:!0,children:S?"Create new user":"Update user profile"}),I&&F&&(0,P.jsx)(v.Z,{ml:1,children:(0,P.jsx)(l.ZP,{danger:!0,loading:ue,onClick:function(){window.confirm("Are you sure you want to delete ".concat(U.username||U.email,"?"))&&ie()},children:"Delete user"})})]})})]})]})}},75083:function(e,r,n){"use strict";n.d(r,{HF:function(){return i},L6:function(){return t}});var t,o=n(72473);function i(e,r,n){var i=e.owner,u=(e.roles,[{Icon:o.WorkspacesIcon,id:t.WORKSPACES,isSelected:function(){return t.WORKSPACES===n},label:function(){return"Workspaces"},linkProps:{href:"/manage"}}]);return i&&u.push({Icon:o.WorkspacesUsersIcon,id:t.USERS,isSelected:function(){return t.USERS===n},label:function(){return"Users"},linkProps:{href:"/manage/users"}}),u.push.apply(u,[{Icon:o.Settings,id:t.SETTINGS,isSelected:function(){return t.SETTINGS===n},label:function(){return"Settings"},linkProps:{href:"/manage/settings"}},{Icon:o.File,id:t.FILE_BROWSER,isSelected:function(){return t.FILE_BROWSER===n},label:function(){return"File browser"},linkProps:{href:"/manage/files"}}]),u}!function(e){e.WORKSPACES="workspaces",e.USERS="users",e.SETTINGS="settings",e.FILE_BROWSER="file_browser"}(t||(t={}))},59533:function(e,r,n){"use strict";var t=n(82684),o=n(94629),i=n(35686),u=n(70515),s=n(75083),a=n(50178),l=n(28598);r.Z=function(e){var r=e.before,n=e.breadcrumbs,d=void 0===n?[]:n,c=e.children,f=e.errors,p=e.headerOffset,v=e.mainContainerHeader,h=e.pageName,m=e.setErrors,b=e.subheaderChildren,w=i.ZP.statuses.list().data,O=(0,t.useMemo)((function(){var e,r;return null===w||void 0===w||null===(e=w.statuses)||void 0===e||null===(r=e[0])||void 0===r?void 0:r.project_type}),[w]),j=(0,a.PR)()||{};return(0,l.jsx)(o.Z,{before:r,beforeWidth:r?50*u.iI:0,breadcrumbs:d,errors:f,headerOffset:p,mainContainerHeader:v,navigationItems:(0,s.HF)(j,O,h),setErrors:m,subheaderChildren:b,title:"Workspaces",uuid:"workspaces/index",children:c})}},37560:function(e,r,n){"use strict";n.r(r);var t=n(77837),o=n(38860),i=n.n(o),u=(n(82684),n(34376)),s=n(93808),a=n(38276),l=n(36043),d=n(59533),c=n(70515),f=n(75083),p=n(28598);function v(){var e=(0,u.useRouter)();return(0,p.jsx)(d.Z,{breadcrumbs:[{label:function(){return"Workspaces"},linkProps:{as:"/manage",href:"/manage"}},{label:function(){return"Users"},linkProps:{as:"/manage/users",href:"/manage/users"}},{bold:!0,label:function(){return"New"}}],pageName:f.L6.USERS,children:(0,p.jsx)(a.Z,{p:c.cd,children:(0,p.jsx)(l.Z,{hideFields:["roles"],newUser:!0,onSaveSuccess:function(r){e.push("/manage/users/[user]","/manage/users/".concat(null===r||void 0===r?void 0:r.id))},title:"Add new user",user:{}})})})}v.getInitialProps=function(){var e=(0,t.Z)(i().mark((function e(r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),r.default=(0,s.Z)(v)},94e3:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/manage/users/new",function(){return n(37560)}])},80022:function(e,r,n){"use strict";function t(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n.d(r,{Z:function(){return t}})},15544:function(e,r,n){"use strict";function t(e){return t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},t(e)}n.d(r,{Z:function(){return t}})},13692:function(e,r,n){"use strict";n.d(r,{Z:function(){return o}});var t=n(61049);function o(e,r){if("function"!==typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&(0,t.Z)(e,r)}},93189:function(e,r,n){"use strict";n.d(r,{Z:function(){return i}});var t=n(12539),o=n(80022);function i(e,r){if(r&&("object"===t(r)||"function"===typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return(0,o.Z)(e)}},61049:function(e,r,n){"use strict";function t(e,r){return t=Object.setPrototypeOf||function(e,r){return e.__proto__=r,e},t(e,r)}n.d(r,{Z:function(){return t}})}},function(e){e.O(0,[6085,1557,8038,9774,2888,179],(function(){return r=94e3,e(e.s=r);var r}));var r=e.O();_N_E=r}]);